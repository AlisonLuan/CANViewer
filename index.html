<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="WebUSB-based CAN bus interface for logging and sending CAN messages directly from your browser.">
  <title>WebUSB CAN Interface</title>
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Skip link for accessibility -->
  <a class="skip-link" href="#main-content">Skip to content</a>

  <header>
    <h1>WebUSB CAN Interface</h1>
    <!-- Primary actions: connect and export log -->
    <nav aria-label="Main actions">
      <button
        type="button"
        id="connect-button"
        aria-controls="connect-status"
        aria-live="polite"
      >
        Connect
      </button>
      <span id="connect-status" role="status">Not Connected</span>
      <button
        type="button"
        id="export-button"
        aria-label="Export the full CAN log"
      >
        Export Log
      </button>
    </nav>
  </header>

  <main id="main-content">
    <!-- CAN bus log section -->
    <section aria-labelledby="log-heading">
      <h2 id="log-heading">CAN Bus Log</h2>
      <!-- Live region for dynamic updates -->
      <div id="log-table-wrapper" aria-live="polite">
        <table id="log-table" class="log-table">
          <caption>Received CAN messages with timestamps, identifiers, and data</caption>
          <thead>
            <tr>
              <th scope="col">Timestamp</th>
              <th scope="col">CAN ID</th>
              <th scope="col">Type</th>
              <th scope="col">DLC</th>
              <th scope="col">Data</th>
            </tr>
          </thead>
          <tbody id="log-body"><!-- Populated by JavaScript --></tbody>
        </table>
      </div>
    </section>

    <!-- Unique-message summary (max 10 rows) -->
    <section aria-labelledby="unique-heading" id="unique-section">
      <h2 id="unique-heading">Unique CAN Messages</h2>
      <button type="button" id="clear-unique">Clear Unique</button>
      <div id="unique-table-wrapper">
        <table id="unique-table" class="log-table">
          <caption>Last 10 unique ID+type messages (most recent)</caption>
          <thead>
            <tr>
              <th scope="col">Timestamp</th>
              <th scope="col">CAN ID</th>
              <th scope="col">Type</th>
              <th scope="col">DLC</th>
              <th scope="col">Data</th>
              <th scope="col">Count</th>
            </tr>
          </thead>
          <tbody id="unique-body">
            <!-- Populated dynamically -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- CAN message sender section -->
    <section aria-labelledby="sender-heading">
      <h2 id="sender-heading">CAN Message Sender</h2>
      <form id="message-sender" novalidate>
        <fieldset>
          <legend>Configure and send CAN messages</legend>

          <div class="form-group">
            <label for="can-id">CAN ID (8 hex digits):</label>
            <input
              type="text"
              id="can-id"
              name="canId"
              maxlength="8"
              pattern="[0-9A-Fa-f]{8}"
              title="Exactly 8 hexadecimal characters (0-9, A-F)"
              placeholder="e.g. 1FFFFFFF"
              required
            >
          </div>

          <div class="form-group">
            <label for="can-id-type">ID Type:</label>
            <select id="can-id-type" name="idType">
              <option value="STD">Standard (11-bit)</option>
              <option value="EXT">Extended (29-bit)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="can-data">Data (hex bytes, space separated):</label>
            <input
              type="text"
              id="can-data"
              name="canData"
              placeholder="e.g. 11 22 33"
              pattern="^([0-9A-Fa-f]{2})(\\s[0-9A-Fa-f]{2})*$"
              title="Hex bytes (2 characters) separated by spaces"
            >
          </div>

          <div class="form-group">
            <label for="send-interval">Send Interval (ms):</label>
            <input
              type="number"
              id="send-interval"
              name="interval"
              min="0"
              max="65535"
              value="100"
            >
          </div>

          <div class="form-group">
            <button type="button" id="send-button">Send Now</button>
          </div>

          <div class="form-group">
            <input
              type="checkbox"
              id="send-on-space"
              name="sendOnSpace"
            >
            <label for="send-on-space">Send on Spacebar</label>
          </div>

        </fieldset>
      </form>
    </section>
  </main>

  <!-- Module script: load and initialize after DOM is ready -->
  <script type="module">
    import { init } from './canUsbLogger.js';
    document.addEventListener('DOMContentLoaded', () => init());
  </script>
</body>
</html>
<!-- End of index.html -->